// Copyright (c) 2023 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import t from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-nonnegative-integer@v0.1.0-esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-positive-integer@v0.1.0-esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-string-array@v0.1.1-esm/index.mjs";import e from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-read-only-property@v0.1.1-esm/index.mjs";import h from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-contains@esm/index.mjs";import r from"https://cdn.jsdelivr.net/gh/stdlib-js/nlp-tokenize@v0.1.1-esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/array-int32@v0.1.1-esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/error-tools-fmtprodmsg@v0.1.1-esm/index.mjs";import a from"https://cdn.jsdelivr.net/gh/stdlib-js/array-float64@v0.1.1-esm/index.mjs";import d from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@v0.1.0-esm/index.mjs";import{isPrimitive as p}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-positive-number@v0.1.1-esm/index.mjs";import m from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-plain-object@v0.1.0-esm/index.mjs";import f from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-own-property@v0.1.1-esm/index.mjs";import l from"https://cdn.jsdelivr.net/gh/stdlib-js/random-base-randu@v0.1.0-esm/index.mjs";import g from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-floor@v0.1.1-esm/index.mjs";function u(){var t,s,i,e,h,r,o;for(1===arguments.length?i=arguments[0]:2===arguments.length&&(i=arguments[0],t=arguments[1]),s=i.length,h=1,o=0;o<s;o++)h*=i[o];return e="int32"===t?new n(h):new a(h),(r={}).dtype=t,r.shape=i,r.strides=[i[1],1],r.offset=0,r.ndims=i.length,r.length=e.length,r.nbytes=e.byteLength,r.data=e,d(r,"get",p),d(r,"set",m),r;function p(t,s){var i=this.offset+t*this.strides[0]+s*this.strides[1];return this.data[i]}function m(t,s,i){return(t=this.offset+t*this.strides[0]+s*this.strides[1])>=0&&(this.data[t]=i),this}}function v(){var t,s,i,e;for(t=u([this.D,this.K]),i=0;i<this.D;i++)for(e=0;e<this.K;e++)s=(this.nd.get(i,e)+this.alpha)/(this.ndSum[i]+this.K*this.alpha),t.set(i,e,s);return t}function j(t,s){return m(s)?f(s,"alpha")&&(t.alpha=s.alpha,!p(t.alpha))?new TypeError(o("0kV4D,Gu","alpha",t.alpha)):f(s,"beta")&&(t.beta=s.beta,!p(t.beta))?new TypeError(o("0kV4D,Gu","beta",t.beta)):null:new TypeError(o("0kV2V,FD",s))}function w(){var t,s,i,e;for(t=u([this.K,this.W]),i=0;i<this.K;i++)for(e=0;e<this.W;e++)s=(this.nw.get(e,i)+this.beta)/(this.nwSum[i]+this.W*this.beta),t.set(i,e,s);return t}function b(){var t,s,i,e,h,r;for(this.z=[],h=0;h<this.D;h++){for(this.z.push([]),i=this.w[h].length,r=0;r<i;r++)s=g(l()*this.K),this.z[h].push(s);for(this.ndSum[h]=i,r=0;r<i;r++)e=this.w[h][r],t=this.z[h][r],this.nw.set(e,t,this.nw.get(e,t)+1),this.nd.set(h,t,this.nd.get(h,t)+1),this.nwSum[t]=this.nwSum[t]+1}}function c(t,s,i){var e,h,r,n,o,a,d,p;for(a=u([r=t.shape[0],n=t.shape[1]]),e=(i-1)/i,h=1/i,d=0;d<r;d++)for(p=0;p<n;p++)o=e*t.get(d,p)+h*s.get(d,p),a.set(d,p,o);return a}function y(t,i,e){var h,r,n,a,d,p,m,f,g,u,v,j,w,b;if(!s(t))throw new TypeError(o("0kV4b,Ht",t));if(!s(i))throw new TypeError(o("0kV45,IB",i));if(!s(e))throw new TypeError(o("0kV5x,Lg",e));for(r=this.W*this.beta,h=this.K*this.alpha,v=0;v<t;v++){for(u=0;u<this.D;u++)for(b=0;b<this.ndSum[u];b++){for(p=this.w[u][b],n=this.z[u][b],this.nw.set(p,n,this.nw.get(p,n)-1),this.nd.set(u,n,this.nd.get(u,n)-1),this.ndSum[u]-=1,this.nwSum[n]-=1,d=[],j=0;j<this.K;j++)d.push((this.nw.get(p,j)+this.beta)/(this.nwSum[j]+r)*(this.nd.get(u,j)+this.alpha)/(this.ndSum[u]+h));for(j=1;j<this.K;j++)d[j]+=d[j-1];for(w=d[this.K-1]*l(),n=0,g=0;g<this.K;g++)if(d[g]>w){n=g;break}this.nw.set(p,n,this.nw.get(p,n)+1),this.nd.set(u,n,this.nd.get(u,n)+1),this.nwSum[n]+=1,this.ndSum[u]+=1,this.z[u][b]=n}v%e==0&&v>i&&(m=this.getPhis(),a=this.getThetas(),this.phiList.push(m),this.thetaList.push(a),f=this.phiList.length,this.avgPhi=1===f?m:c(this.avgPhi,m,f),f=this.thetaList.length,this.avgTheta=1===f?a:c(this.avgTheta,a,f))}}function x(t,s){var i;for(i=0;i<t.length;i++)if(t[i]===s)return i;return-1}function T(a,d,p){var m,f,l,g,c,T,S,k,K,V,E,L,z,D,W,P,B;if(!i(a))throw new TypeError(o("0kV3s,Jl",a));if(!s(d))throw new TypeError(o("0kV5y,Le",d));if(T={},arguments.length>2&&(S=j(T,p)))throw S;for(L=a.length,g=T.alpha||50/d,c=T.beta||.1,f=[],B=[],k=0,z=0;z<L;z++)for(B.push([]),K=(E=r(a[z])).length,D=0;D<K;D++)m=E[D],-1===(V=x(f,m))?(f.push(m),B[z].push(k),k+=1):B[z].push(V);return P=f.length,e(l={},"K",d),e(l,"D",L),e(l,"W",P),e(l,"alpha",g),e(l,"beta",c),e(l,"init",b),e(l,"fit",y),e(l,"getPhis",w),e(l,"getThetas",v),e(l,"getTerms",G),l.nwSum=new n(d),l.ndSum=new n(L),l.nw=u([P,d],"int32"),l.nd=u([L,d],"int32"),l.phiList=[],l.thetaList=[],l.w=B,l.init(),l;function G(i,e){var r,n,a,p,m,l;if(!t(i)||i>=d)throw new TypeError(o("0kV5z,Lf",i));if(e){if(!s(e))throw new TypeError(o("0kV45,IB",e))}else e=10;for(a=[],r=[],l=0;l<e;l++){for(p=0,W=0;W<this.W;W++)(n=this.avgPhi.get(i,W))>p&&!h(r,W)&&(p=n,m=W);r.push(m),a.push({word:f[m],prob:p})}return a}}export{T as default};
//# sourceMappingURL=index.mjs.map
